local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")

local DASH_REMOTE_NAME = "Forward Dash Attack"
local SUPA_TECH_FLOAT_HEIGHT = 5
local SUPA_TECH_FLOAT_TIME = 0.15
local NO_KNOCKBACK_MASS = 2000
local HITBOX_MULT = 1.5

local lastHitTarget = nil
local LOCK_ENABLED = true
local currentRoot = nil
local isAboveTarget = false

local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
local StatusBox = Instance.new("Frame", ScreenGui)
StatusBox.Size = UDim2.new(0,20,0,20)
StatusBox.Position = UDim2.new(1,-30,1,-30)
StatusBox.BackgroundColor3 = Color3.fromRGB(0,255,0)

local function updateLastHit(target)
    lastHitTarget = target
end

local function updateGUI()
    StatusBox.BackgroundColor3 = LOCK_ENABLED and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
end

local function supaTech(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") or not currentRoot then return end
    local targetPos = target.HumanoidRootPart.Position + Vector3.new(0,SUPA_TECH_FLOAT_HEIGHT,0)
    isAboveTarget = true
    TweenService:Create(currentRoot, TweenInfo.new(SUPA_TECH_FLOAT_TIME, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {CFrame = CFrame.new(targetPos)}):Play()
end

local function applyBuff(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    target.HumanoidRootPart.CustomPhysicalProperties = PhysicalProperties.new(NO_KNOCKBACK_MASS,0.3,0.5)
    if LOCK_ENABLED then
        local hitbox = target:FindFirstChildWhichIsA("Part") or target:FindFirstChild("HumanoidRootPart")
        if hitbox then
            hitbox.Size = hitbox.Size * HITBOX_MULT
        end
    end
end

for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
    if obj:IsA("RemoteEvent") and obj.Name == DASH_REMOTE_NAME then
        obj.OnClientEvent:Connect(function()
            if lastHitTarget then
                supaTech(lastHitTarget)
                applyBuff(lastHitTarget)
            end
        end)
    end
end

UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local mouse = LocalPlayer:GetMouse()
        if mouse.Target and mouse.Target.Parent then
            local targetHumanoid = mouse.Target.Parent:FindFirstChild("Humanoid")
            if targetHumanoid and Players:FindFirstChild(mouse.Target.Parent.Name) then
                updateLastHit(mouse.Target.Parent)
            end
        end
    elseif input.KeyCode == Enum.KeyCode.T then
        LOCK_ENABLED = not LOCK_ENABLED
        updateGUI()
    end
end)

RunService.RenderStepped:Connect(function()
    if not LOCK_ENABLED then return end
    if not lastHitTarget or not currentRoot then return end
    local targetRoot = lastHitTarget:FindFirstChild("HumanoidRootPart")
    if targetRoot then
        local currentCFrame = currentRoot.CFrame
        local targetCFrame = CFrame.new(targetRoot.Position + Vector3.new(0,SUPA_TECH_FLOAT_HEIGHT,0))
        if isAboveTarget then
            currentRoot.CFrame = targetCFrame
        else
            currentRoot.CFrame = currentCFrame:Lerp(CFrame.new(currentRoot.Position, targetRoot.Position), 0.2)
        end
    end
end)

local function onCharacterAdded(char)
    currentRoot = char:WaitForChild("HumanoidRootPart")
    isAboveTarget = false
end

if LocalPlayer.Character then
    onCharacterAdded(LocalPlayer.Character)
end
LocalPlayer.CharacterAdded:Connect(onCharacterAdded)
updateGUI()
