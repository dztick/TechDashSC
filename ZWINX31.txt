local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote names
local UPPERCUT_REMOTE_NAME = "Uppercut Attack"
local DASH_REMOTE_NAME = "Forward Dash Attack"

-- State
local currentRoot = nil
local lastHitTarget = nil

-- Fire remote with position
local function fireRemote(remoteName, position)
    local remote = ReplicatedStorage:FindFirstChild(remoteName)
    if remote then
        remote:FireServer({["Target"] = lastHitTarget, ["Position"] = position})
    end
end

-- Dash ke atas
local function dashUpward()
    if currentRoot then
        local upwardPos = currentRoot.Position + Vector3.new(0, 10, 0)
        currentRoot.CFrame = CFrame.new(currentRoot.Position, upwardPos)
        fireRemote(DASH_REMOTE_NAME, upwardPos)
    end
end

-- Uppercut + dash chaining
local function uppercutDash()
    if lastHitTarget and currentRoot and lastHitTarget:FindFirstChild("HumanoidRootPart") then
        local targetPos = lastHitTarget.HumanoidRootPart.Position
        fireRemote(UPPERCUT_REMOTE_NAME, targetPos)

        task.delay(0.3, function()
            dashUpward()
        end)
    end
end

-- Input handler
UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end

    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local mouse = LocalPlayer:GetMouse()
        if mouse.Target and mouse.Target.Parent and mouse.Target.Parent:FindFirstChild("HumanoidRootPart") then
            lastHitTarget = mouse.Target.Parent
        end
    elseif input.KeyCode == Enum.KeyCode.R then
        uppercutDash()
    end
end)

-- Get root part
local function onCharacterAdded(char)
    currentRoot = char:WaitForChild("HumanoidRootPart")
end
if LocalPlayer.Character then onCharacterAdded(LocalPlayer.Character) end
LocalPlayer.CharacterAdded:Connect(onCharacterAdded)
